Satria Ady Pradana, [19.05.17 20:09]
ok, thanks semua. Terima kasih sudah datang di kulgram Reversing.ID 
kali ini.

Satria Ady Pradana, [19.05.17 20:12]
Malam ini adalah kulgram pertama dari seri kulgram reversing malware. 
Ide dasar dari malware analysis adalah reverse engineering juga untuk 
software, tapi tentu kita tahu bahwa malware itu memberi dampak buruk
dan gak bisa kita sembarangan melakukannya. Salah-salah kita bisa 
menginfeksi diri sendiri dan jaringan kita.

Satria Ady Pradana, [19.05.17 20:13]
di pekan depan kita akan bahas tentang analisisnya, tapi sebelum itu 
kita harus bikin dulu lingkungan kerja kita. Itulah yang akan kita 
lakukan malam ini.

Satria Ady Pradana, [19.05.17 20:17]
membangun environment untuk analisis sebenarnya akan bergantung kepada 
apa yang mau kita analisis. Seperti menganalisis malware untuk windows 
akan berbeda untuk malware di mac. Tapi sebenarnya ada beberapa hal 
dasar yang bisa kita lakukan.

Satria Ady Pradana, [19.05.17 20:20]
saat ini orang banyak memakai pendekatan dengan memanfaatkan VM untuk 
membangun environment buat testing dan analisis. Kenapa? Simple, karena 
VM mudah dibikin dan mudah dihancurkan. Ada pula fitur seperti snapshot 
sehingga kita bisa menyimpan state. Misal kondisi sekarang abis fresh 
install tools, ketika terjadi masalah yang gak bisa kita atasi maka 
kita tinggal balikin ke kondisi semula.

Satria Ady Pradana, [19.05.17 20:21]
VirtualBox, VMWare, Parallel Desktop, dsb. Ada banyak pilihannya. 
Tapi kita pake yang free aja. VirtualBox. Kemudian OS yang kita pilih 
adalah Windows 7. VirtualBox dipilih karena free dan open source. 
Windows 7 dipilih karena masih banyak malware menginfeksi windows.

Satria Ady Pradana, [19.05.17 20:25]
Supaya malware gak menyebar keluar, maka langkah pertama dalam membangun
lab adalah mengisolasi VM kita. Isolasi seperti apa? Kita tidak ingin 
VM bisa mengakses jaringan kita. Tapi bagaimana jika kita ingin melihat 
bagaimana malware menyebar? Berarti kita perlu bikin jaringan tersendiri 
dimana hanya ada VM tersebut dan sama sekali tak bisa akses ke luar, 
termasuk ke komputer kita

Satria Ady Pradana, [19.05.17 20:27]
[ Photo ] photo_2017-05-19_20-27-38.jpg

Satria Ady Pradana, [19.05.17 20:30]
Ada beberapa mode jaringan di Virtualisasi: NAT, Bridge, Host only network,
dan internal.

Dari keempat mode network tersebut, mana yang baiknya kita gunakan? 

NAT (Network Address Translation) biasa digunakan di jaringan pada umumnya.
Digunakan seperti di firewall. Di mode ini VM-VM dapat mengakses internet 
tapi melalui sebuah gateway. VM akan mendapatkan IP private dan untuk 
berkomunikasi harus ditranslasikan dulu.

Bridged artinya VM akan mendapatkan alokasi IP juga dari router yang ada 
di jaringan. Artinya host kita dan VM akan berada di 1 segment.

Host only artinya VM tidak bisa ke luar tapi bisa menghubungi host

Internal network artinya VM tidak bisa terhubung ke luar sama sekali. 
Ia hanya bisa berhubungan dengan Vm yang berada di jaringan yang sama (khusus)

Satria Ady Pradana, [19.05.17 20:31]
karena kita menginginkan jangan sampai ada mesin di luar yang terinfeksi 
maka sebaiknya kita mengeset network ke internal.

Satria Ady Pradana, [19.05.17 20:31]
bagaimana dengan mesin itu sendiri? apa saja yang mesti kita persiapkan? Tools?

Satria Ady Pradana, [19.05.17 20:32]
sebelum kita bahas itu, ada baiknya kita mundur sejenak dan bertanya 
"apa sih yang mau kita analisis?"

Satria Ady Pradana, [19.05.17 20:34]
kalo kita sebut satu per satu mungkin akan banyak, tergantung motif. Tapi 
sebenarnya ada 2 pertanyaan besar buat dipecahkan.

1. bagaimana malware ini menyebar?
2. apa yang malware ini lakukan?

Satria Ady Pradana, [19.05.17 20:38]
dari sana kita bisa mencari tools yang cocok untuk menjawab pertanyaan tadi.

1. bagaimana malware menyebar?
untuk berpindah dari satu tempat ke tempat lain maka dia bisa melalui jaringan, 
melalui storage, dsb

maka kita perlu tools untuk melihat apa yang terjadi pada jaringan ketika malware 
dieksekusi dan setelahnya.
Kita juga perlu mengamati barangkali ada file-file yang dibentuk oleh malware 
untuk menggandakan diri.

2. apa yang malware ini lakukan?
disebut juga payload.
beranak pinak? mengenkripsi semua file? menulis ke registry? berjalan pada saat 
windows start? mengendalikan komputer? menghubungi malware author?

dengan demikian kita butuh tools untuk mengawasi perubahan apa saja yang terjadi 
di file system, di registry, dan hal-hal lain di sistem kita.

Satria Ady Pradana, [19.05.17 20:41]
beberapa tools sudah saya sebut buat didonlot dan dicoba.

Wireshark untuk menangkap paket yang lewat di jaringan.
regshot buat menangkap perubahan kondisi registry
fakenet buat membuat jaringan palsu sehingga kita bisa tau siapa saja yang coba 
dihubungi oleh malware.

apakah hanya ini tools-nya? apakah mereka yang terbaik? nggak juga. Sebagai 
reverser ataupun analyst kita harus tau apa yang tools bisa lakukan dan 
menggunakannya dengan kemampuan kita

Satria Ady Pradana, [19.05.17 20:46]
setelah install semua tools, langkah awal kita adalah memutuskan koneksi ke host. 
Termasuk juga folder sharing. Kita gak pernah tau apakah malware bisa mengeksploit 
kelemahan VBox dan lepas ke host jadi kita putuskan semua hal yang bisa menghubungkan 
kita dengan VM. Karena itulah saya nggak pake virtualbox guest addition hehe

Satria Ady Pradana, [19.05.17 20:47]
coba ping host dengan IP manapun yang host punya.

Satria Ady Pradana, [19.05.17 20:48]
setelah itu buat snapshot. Jika terjadi kegagalan, maka kita bisa kembali ke kondisi 
saat VM masih bersih. Kalo perlu analisis malware lain pun kita bisa langsung saja 
kembali ke kondisi ini.


Satria Ady Pradana, [19.05.17 20:50]
Machine -> Take Snapshot 
isikan sesuai kebutuhan.

Satria Ady Pradana, [19.05.17 20:52]
sekarang baru kita beralih ke apa yang kita perlukan buat analisis malware

menganalisis malware seperti halnya menganalis software, kita punya banyak metode 
untuk melakukannya.

Satria Ady Pradana, [19.05.17 20:58]
ada 2 pendekatan.

- static analysis
- dynamis analysis

static analysis artinya kita menganalisis tanpa menjalankan kode itu. Apa 
yang bisa kita dapatkan? Fungsi yang dipakai. DLL yang dibutuhkan. Bahkan 
barangkali string alamat tempat malware ini akan menghubungkan diri

dynamic analysis artinya kita menganalisis dengan cara menjalankan malware
tersebut. Bisa dengan cara kita debug. Dengan debugging kita bisa tau kondisi 
program pada saat tertentu.

Satria Ady Pradana, [19.05.17 20:59]
untuk static analysis kita bisa menggunakan ida pro. Sebenarnya komersial 
dan mahal (banyak crack sih) tapi biar aman pakai saja yang free hehe

untuk debugger juga ada banyak pilihan. Yang terkenal adalah ollydbg tapi 
karena ollydbg sudah gak dikembangkan lagi, maka kita pakai immunity debugger 
yang mirip-mirip.

Satria Ady Pradana, [19.05.17 21:04]
oke, itu dasar mengenai tools. Sudah punya gambaran kenapa kita pilih tools 
itu dan apa yang bisa kita lakukan.

Sekarang bagaimana kalo kita nemu malware? bagaimana langkah standard buat 
menganalisisnya?

well, setiap orang bisa punya alur tersendiri tapi aku menyarankan seperti ini:

Satria Ady Pradana, [19.05.17 21:10]
1. coba upload ke layanan seperti VirusTotal dsb, apakah sample itu pernah 
menyebar sebelumnya? Jika iya kita bisa liat analisis yang sudah pernah dilakukan. 
Ini bisa menjadi starting point bagi kita untuk memulai analisis

2. dapatkan informasi tentang malware dulu, seperti md5 hash, kapan aplikasi itu 
dibuat, apakah ada ciri-ciri tertentu apa nggak?

3. biarkan malware berjalan kemudian kumpulkan semua perubahan yang terjadi 
pada sistem. Seperti yang sudah dijelaskan sebelumnya: file, registry, process, 
traffic, dsb.

4. disassembly malware, pahami dulu kodenya. Nggak perlu menyeluruh dulu. Yang 
kita cari bisa penggunaan API tertentu. Misalnya ransomware ini ternyata memakai 
fungsi bawaan windows untuk melakukan enkripsi. Lalu ternyata ada proteksi di 
ransomware ini. 

5. debug malware-nya, bila kita perlu untuk melakukannya.

Satria Ady Pradana, [19.05.17 21:12]
satu yang menarik dari list tools yang dibahas, kenapa perlu python?

Satria Ady Pradana, [19.05.17 21:17]
kadang kala kita perlu membuat suatu program ato membuat kode tertentu 
untuk menyelesaikan masalah. Misal untuk membantu kita melakukan decode 
terhadap suatu string yang sudah kita ketahui cara kerjanya. Daripada 
menulis pakai tangan, lebih baik dikerjakan oleh program.

Dan banyak sekali orang yang sudah memprogram utility dengan python jadi 
kita bisa tinggal memakainya.

Satria Ady Pradana, [19.05.17 21:24]
next, tools sudah dibahas, basic analysis sudah dibahas, lalu?

apakah pembuat malware yang professional pasrah begitu saja ketika 
malware-nya dianalisis?


Satria Ady Pradana, [19.05.17 21:27]
ada analysis pasti akan ada antinya. Beberapa malware diprogram 
khusus untuk melakukan hal yang berbeda ketika dia tau bahwa dia 
sedang dianalisis. Misal, ketika didebug dia akan menghubungi 
alamat yang berbeda dengan alamat yang asli

Satria Ady Pradana, [19.05.17 21:27]
dan kadangkala malware berusaha untuk mengecoh kita

Satria Ady Pradana, [19.05.17 21:28]
tak jarang juga malware memproteksi dirinya sendiri dengan cara menggunakan 
packer sehingga kode utama tdak akan diketahui ketika kita cuman sekedar 
melakukan static analysis.

Satria Ady Pradana, [19.05.17 21:29]
ada banyak hal, dan itulah tantangannya ketika kita menganalisis malwre.

Satria Ady Pradana, [19.05.17 21:32]
so itu dulu deh untuk kali ini. Kalo dirangkum, bahasan kita malam ini adalah.

1. bagaimana mempersiapkan environment: 
- interaksi sesedikit mungkin dengan host dan jaringan.
- dapat dibalikin ke kondisi yang kita inginkan

2. tools yang perlu kita persiapkan dan kenapa.

3. langkah sangat umum untuk menganalisis malware
- ada 5 minimum

4. proteksi yang dimiliki oleh malware yang perlu kita waspadai.

Satria Ady Pradana, [19.05.17 21:43]
oh iya, tambahan lagi.
Itu tadi untuk windows, bagaimana dengan yang lain? Misal linux? Mac?

Konsepnya sama aja, cuman beda tools yang kita gunakan untuk mencapainya.

- jangan ada koneksi dari guest ke host
- install tools untuk membedah program
- install tools untuk mengamati perubahan yang dilakukan oleh malware

Satria Ady Pradana, [19.05.17 21:33]
jadi, mari kita buka sesi diskusi kita.

maaf kalo kurang jauh pembahasannya